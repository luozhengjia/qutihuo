<@override name="page-content">  
    <div class="page-breadcrumbs">
        <ul class="breadcrumb">
            <li><i class="fa fa-home"></i><a href="#">礼品卡管理</a></li>
            <li><a href="/coupon/couponSchemaList.jhtml">礼品卡方案</a></li>
            <li>新增礼品卡方案</li>
        </ul>
    </div>
    
	<div class="page-body">
        <div class="row">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
            <div class="col-xs-12 col-md-12">
            	<div class="widget with-header">
                	<div class="widget-header">
                    	<span class="widget-caption"><i class="glyphicon glyphicon-edit"></i>&nbsp;<b>新增礼品卡方案</b></span>
                    	
						<div class="widget-buttons">
							<a href="${_referUrl!'/coupon/couponSchemaList.jhtml'}" class="btn">&nbsp;&nbsp;<i class="typcn typcn-arrow-back"></i>&nbsp;&nbsp;</a>
						</div>
                    </div>
                
                	<div class="widget-body">
						<form id="html5Form" method="post" class="form-horizontal" method="POST" action="/coupon/saveCouponSchema.jhtml">
							<fieldset ${(couponSchema??&&couponSchema.hasIssueNum &gt;0)?string('disabled','')}>
								<input type="hidden" name="id"/>
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">礼品卡名称<font color="red"> *</font></label>
		                            <div class="col-lg-6">
		                                <input type="text" class="form-control" name="couponName"/>
		                            </div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">礼品卡图标<font color="red"> *</font></label>
		                            <div class="col-lg-10">
		                            	<input type="text" class="form-control" id="iconUrl" name="iconUrl"/>
									</div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">礼品卡面值<font color="red"> *</font></label>
		                            <div class="col-lg-2">
		                            	<input type="text" class="form-control" name="parValue"/>
									</div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <label for="reservation" class="col-lg-2 control-label">有效期<font color="red"> *</font></label>
		                            <div class="col-lg-5">
		                            	<div class="input-group">
		                                    <input class="form-control" type="text" name="useStartdate" id="useStartdate">
		                                    <span class="input-group-addon">至</span>
		                                    <input class="form-control" type="text" name="useEnddate" id="useEnddate">
		                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
		                                </div>
		                            </div>
		                        </div>
		                            
								<div class="form-group">
		                            <label class="col-lg-2 control-label">总发行量<font color="red"> *</font></label>
		                            <div class="col-lg-2">
		                                <input type="text" class="form-control" name="issueAmount"/>
		                            </div>
		                            <div class="col-lg-4"><p class="help-block">总共发行卡券数量，最大值不能超过1000</p></div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">日限兑换量</label>
		                            <div class="col-lg-2">
		                                <input type="text" class="form-control" name="dayLimitNum"/>
		                            </div>
		                            <div class="col-lg-4"><p class="help-block">每日兑换商品的最大数量</p></div>
		                        </div>
		
								<div class="form-group">
		                            <label class="col-lg-2 control-label">提前预约天数</label>
		                            <div class="col-lg-2">
		                                <input type="text" class="form-control" name="frontDayNum"/>
		                            </div>
		                            <div class="col-lg-6"><p class="help-block">提前预约的天数，如2天则最早到后天才能预约</p></div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">是否默认激活</label>
		                            <div class="col-lg-2">
		                            	<select name="initActivate" class="form-control">
		                            		<option value="2">激活</option> 
		                            		<option value="1">不激活</option> 
	                                    </select>
		                            </div>
		                            <div class="col-lg-6"><p class="help-block">选择“激活”生成券后时会自动激活优惠券；否则需要手动激活优惠券</p></div>
		                        </div>
                                    
		                        <div class="form-group">
		                            <label class="col-lg-2 control-label">礼品介绍<font color="red"> *</font></label>
		                            <div class="col-lg-8">
		                                <textarea class="form-control" name="remark" rows="5"></textarea>
		                            </div>
		                        </div>
		                        
		                        <div class="form-group">
		                            <div class="col-lg-2 col-lg-offset-2">
		                            	 <button type="submit" class="btn btn-success">确认</button>
		                            </div>
		                        </div>
		                	</fieldset>
	                    </form>
	                </div>
                </div>

            </div>
        </div>
    </div>
</@override>
<@override name="custom-script">
   	<script>
		$(document).ready(function() {
			// 构建表单数据	
			var formData = {			
	         	"id":${(couponSchema.id)!'null'},
				"couponName":"${(couponSchema.couponName)!''}",
				"parValue":"${(couponSchema.parValue)!''}",
				"iconUrl":"${(couponSchema.iconUrl)!''}",
				"useStartdate":"${(couponSchema.useStartdate?string('yyyy-MM-dd 00:00'))!''}",
				"useEnddate":"${(couponSchema.useEnddate?string('yyyy-MM-dd 23:59'))!''}",
				"issueAmount":${(couponSchema.issueAmount?c)!100}, 
				"dayLimitNum":${(couponSchema.dayLimitNum?c)!10},
				"frontDayNum":"${(couponSchema.frontDayNum?c)!2}",
				"remark":"${(couponSchema.remark)!''}"
	        };
	        
			// 自动填充表单
	        $("#html5Form").autofill(formData);
		
			// 开始日期
	        $('#useStartdate').datetimepicker({language:'zh-CN',autoclose: 1,todayHighlight: 1, minView: 2,format:'yyyy-mm-dd 00:00'}).on('changeDate', function(ev){
				 $('#useEnddate').datetimepicker('setStartDate', $(this).val());
				 $('#html5Form').formValidation('revalidateField', 'useStartdate');
			});
			
			// 结束日期
			$('#useEnddate').datetimepicker({language:'zh-CN',autoclose: 1,todayHighlight: 1, minView: 2,format:'yyyy-mm-dd 23:59'}).on('changeDate', function(ev){
				 $('#useStartdate').datetimepicker('setEndDate', $(this).val());
				 $('#html5Form').formValidation('revalidateField', 'useEnddate');
			});
			
			// 图片上传
			$('#iconUrl').imgUploader({max:1,callback:function(){
				$('#html5Form').formValidation('revalidateField', 'iconUrl');
			}});
			
			// 提交表单
			$('#html5Form').formValidation({
				fields: {
		            couponName: {
		                validators: {
		                    notEmpty: {
		                        message: '礼品卡名称不能为空'
		                    }
		                }
		            },
		            parValue: {
		                validators: {
		                    notEmpty: {
		                        message: '礼品卡面值不能为空'
		                    }
		                }
		            },
		            iconUrl: {
		                validators: {
		                    notEmpty: {
		                        message: '礼品卡图标不能为空'
		                    }
		                }
		            },
		            useStartdate: {
		                validators: {
		                    notEmpty: {
		                        message: '有效期开始日期不能为空'
		                    }
		                }
		            },
		            useEnddate: {
		                validators: {
		                    notEmpty: {
		                        message: '有效期结束日期不能为空'
		                    }
		                }
		            },
		            issueAmount: {
		                validators: {
		                    notEmpty: {
		                        message: '总发行量不能为空'
		                    }
		                }
		            },
		            remark: {
		                validators: {
		                    notEmpty: {
		                        message: '礼品介绍不能为空'
		                    }
		                }
		            }
		        }
			})        
			.on('success.form.fv', function(e) {
	            // Prevent form submission
	            e.preventDefault();
	
	            // Get the form instance
	            var $form = $(e.target);
	
	            // Get the FormValidation instance
	            var bv = $form.data('formValidation');
	            
	            // Use Ajax to submit form data
	            $.post($form.attr('action'), $form.serialize(), function(result) {
	                if(result.state.code==200){
		        		Notify('操作成功', 'bottom-right', '1500', 'success', 'fa-check', true);
		        		setTimeout(function () {window.location = "${_referUrl!'/coupon/couponSchemaList.jhtml'}";}, 1500);
		        	}else{
		        		Notify(result.state.msg, 'bottom-right', '1500', 'danger', 'fa-bolt', true); 
		        	}
	            }, 'json');
	        });
		});
	</script>
</@override>
<@extends name="/common/base.html"/>  

